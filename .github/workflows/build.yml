on: [push]

jobs:

  build:

    strategy:
      matrix:
        python-version: 
          - "2.7"
        os:
          # - ubuntu-16.04
          - macos-latest
        # include:
        #   - os: ubuntu-16.04
        #     python-version: "2.7"
        #     platform-options: "--plat-name=manylinux2014_x86_64"
        

    runs-on: ${{ matrix.os }}

    steps:

    - uses: actions/checkout@v2

    - name: Checkout submodules
      shell: bash
      run: |
        git submodule update --init --force --recursive
    
    # - name: Set up Python ${{ matrix.python-version }}
    #   uses: actions/setup-python@v1
    #   with:
    #     python-version: ${{ matrix.python-version }}
        
    - name: Build
      run: |
        which python
        python --version
        which python2
        python2 --version
        which python3
        python3 --version
        which pip
        pip --version
        pip install --user ninja --verbose
        python setup.py build

    - name: Create package
      run: |
        pip install wheel
        python setup.py bdist_wheel ${{ matrix.platform-options }}

    - name: Publish package
      # if: startsWith(github.event.ref, 'refs/tags')
      uses: pypa/gh-action-pypi-publish@master
      with:
        user: __token__
        password: ${{ secrets.pypi_password }}
